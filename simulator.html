<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoCAD - Circuit Simulator</title>
    <meta name="description" content="ÍµêÏú°Ïö© ÎîîÏßÄÌÑ∏ ÎÖºÎ¶¨ ÌöåÎ°ú ÏãúÎÆ¨Î†àÏù¥ÌÑ∞">
    <link rel="stylesheet" href="css/simulator.css?v=2">
    <script src="js/modules/Security.js"></script>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2358a6ff' d='M13 3L4 14h7v7l9-11h-7V3z'/%3E%3C/svg%3E">
    <script>
        // Ï¥àÍ∏∞ Î°úÎî© ÏóêÎü¨(ReferenceError: sim is not defined) Î∞©ÏßÄÏö© ÎçîÎØ∏ Í∞ùÏ≤¥
        window.sim = window.sim || {
            showTooltip: function () { },
            hideTooltip: function () { },
            positionTooltip: function () { },
            toggleSection: function () { },
            addModule: function () { },
            saveProject: function () { },
            updateProjectName: function () { },
            exportProject: function () { },
            cloud: {
                saveProjectToCloud: function () { },
                triggerAutoSave: function () { }
            }
        };
    </script>
</head>

<body>
    <!-- SVG Icon Definitions -->
    <svg style="display: none;">
        <defs>
            <!-- UI Icons -->
            <symbol id="icon-home" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
            </symbol>
            <symbol id="icon-chevron-left" viewBox="0 0 24 24">
                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
            </symbol>
            <symbol id="icon-chevron-right" viewBox="0 0 24 24">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
            </symbol>
            <symbol id="icon-chevron-down" viewBox="0 0 24 24">
                <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" />
            </symbol>

            <!-- File Icons -->
            <symbol id="icon-file" viewBox="0 0 24 24">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
            </symbol>
            <symbol id="icon-save" viewBox="0 0 24 24">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                <polyline points="17 21 17 13 7 13 7 21" />
                <polyline points="7 3 7 8 15 8" />
            </symbol>
            <symbol id="icon-export" viewBox="0 0 24 24">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="17 8 12 3 7 8" />
                <line x1="12" y1="3" x2="12" y2="15" />
            </symbol>

            <!-- Edit Icons (Undo/Redo Updated) -->
            <symbol id="icon-undo" viewBox="0 0 24 24">
                <path
                    d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.17 8 12.5 8z" />
            </symbol>
            <symbol id="icon-redo" viewBox="0 0 24 24">
                <path
                    d="M18.4 10.6C16.55 9 14.15 8 11.5 8c-4.67 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z" />
            </symbol>
            <symbol id="icon-copy" viewBox="0 0 24 24">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
            </symbol>
            <symbol id="icon-paste" viewBox="0 0 24 24">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
            </symbol>
            <symbol id="icon-duplicate" viewBox="0 0 24 24">
                <rect x="3" y="3" width="8" height="8" rx="1" />
                <rect x="13" y="13" width="8" height="8" rx="1" />
                <path d="M11 8h2v3h3v2h-3v3h-2v-3H8v-2h3V8z" />
            </symbol>
            <symbol id="icon-trash" viewBox="0 0 24 24">
                <polyline points="3 6 5 6 21 6" />
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
            </symbol>

            <!-- Tool Icons -->
            <symbol id="icon-select" viewBox="0 0 24 24">
                <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z" />
            </symbol>
            <symbol id="icon-pan" viewBox="0 0 24 24">
                <path
                    d="M18 11V6a2 2 0 0 0-2-2 2 2 0 0 0-2 2v1a2 2 0 0 0-2-2 2 2 0 0 0-2 2v5a6 6 0 0 0 6 6h2a6 6 0 0 0 6-6V9a2 2 0 0 0-2-2 2 2 0 0 0-2 2" />
            </symbol>
            <symbol id="icon-wire" viewBox="0 0 24 24">
                <path
                    d="M12 2v6M12 16v6M6 12H2M22 12h-4M4.93 4.93l4.24 4.24M14.83 14.83l4.24 4.24M4.93 19.07l4.24-4.24M14.83 9.17l4.24-4.24" />
            </symbol>

            <!-- Playback Icons -->
            <symbol id="icon-play" viewBox="0 0 24 24">
                <polygon points="5 3 19 12 5 21 5 3" />
            </symbol>
            <symbol id="icon-pause" viewBox="0 0 24 24">
                <rect x="6" y="4" width="4" height="16" />
                <rect x="14" y="4" width="4" height="16" />
            </symbol>
            <symbol id="icon-step" viewBox="0 0 24 24">
                <polygon points="5 4 15 12 5 20 5 4" />
                <line x1="19" y1="5" x2="19" y2="19" />
            </symbol>
            <symbol id="icon-reset" viewBox="0 0 24 24">
                <polyline points="1 4 1 10 7 10" />
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" />
            </symbol>

            <!-- Zoom Icons -->
            <symbol id="icon-zoom-in" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                <line x1="11" y1="8" x2="11" y2="14" />
                <line x1="8" y1="11" x2="14" y2="11" />
            </symbol>
            <symbol id="icon-zoom-out" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                <line x1="8" y1="11" x2="14" y2="11" />
            </symbol>
            <symbol id="icon-zoom-fit" viewBox="0 0 24 24">
                <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" />
            </symbol>

            <!-- Component Icons -->
            <symbol id="icon-switch" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" />
                <path d="M12 8v4l3 3" />
            </symbol>
            <symbol id="icon-led" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="8" />
                <path d="M12 2v2M12 20v2M2 12h2M20 12h2" />
            </symbol>
            <symbol id="icon-clock" viewBox="0 0 24 24">
                <rect x="3" y="3" width="18" height="18" rx="2" />
                <polyline points="8 12 11 12 11 8" />
                <polyline points="13 12 16 16" />
            </symbol>

            <!-- Gate Icons (ANSI Standard Symbols) -->
            <!-- AND Gate: D shape -->
            <symbol id="icon-gate-and" viewBox="0 0 60 40">
                <path d="M10 5 L30 5 A 15 15 0 0 1 30 35 L10 35 Z" fill="none" stroke="currentColor" stroke-width="3" />
                <line x1="10" y1="5" x2="10" y2="35" stroke="currentColor" stroke-width="3" />
            </symbol>

            <!-- OR Gate: Curved shape -->
            <symbol id="icon-gate-or" viewBox="0 0 60 40">
                <path d="M10 5 C 10 5, 20 5, 30 15 C 40 25, 30 35, 10 35 C 15 25, 15 15, 10 5 Z" fill="none"
                    stroke="currentColor" stroke-width="3" />
                <!-- Output line is handled by pin or extended path -->
            </symbol>

            <!-- NOT Gate: Triangle + Bubble -->
            <symbol id="icon-gate-not" viewBox="0 0 60 40">
                <path d="M15 5 L40 20 L15 35 Z" fill="none" stroke="currentColor" stroke-width="3" />
                <circle cx="44" cy="20" r="3" fill="none" stroke="currentColor" stroke-width="3" />
            </symbol>

            <!-- NAND Gate: AND + Bubble -->
            <symbol id="icon-gate-nand" viewBox="0 0 60 40">
                <path d="M10 5 L30 5 A 15 15 0 0 1 30 35 L10 35 Z" fill="none" stroke="currentColor" stroke-width="3" />
                <line x1="10" y1="5" x2="10" y2="35" stroke="currentColor" stroke-width="3" />
                <circle cx="48" cy="20" r="3" fill="none" stroke="currentColor" stroke-width="3" />
            </symbol>

            <!-- NOR Gate: OR + Bubble -->
            <symbol id="icon-gate-nor" viewBox="0 0 60 40">
                <path d="M10 5 C 10 5, 20 5, 30 15 C 40 25, 30 35, 10 35 C 15 25, 15 15, 10 5 Z" fill="none"
                    stroke="currentColor" stroke-width="3" />
                <circle cx="44" cy="20" r="3" fill="none" stroke="currentColor" stroke-width="3" />
            </symbol>

            <!-- XOR Gate: Double curve -->
            <symbol id="icon-gate-xor" viewBox="0 0 60 40">
                <path d="M15 5 C 15 5, 25 5, 35 15 C 45 25, 35 35, 15 35 C 20 25, 20 15, 15 5 Z" fill="none"
                    stroke="currentColor" stroke-width="3" />
                <path d="M8 5 C 13 15, 13 25, 8 35" fill="none" stroke="currentColor" stroke-width="3" />
            </symbol>

            <!-- XNOR Gate: XOR + Bubble -->
            <symbol id="icon-gate-xnor" viewBox="0 0 60 40">
                <path d="M15 5 C 15 5, 25 5, 35 15 C 45 25, 35 35, 15 35 C 20 25, 20 15, 15 5 Z" fill="none"
                    stroke="currentColor" stroke-width="3" />
                <path d="M8 5 C 13 15, 13 25, 8 35" fill="none" stroke="currentColor" stroke-width="3" />
                <circle cx="48" cy="20" r="3" fill="none" stroke="currentColor" stroke-width="3" />
            </symbol>

            <!-- Package/Expert Icons -->
            <symbol id="icon-package" viewBox="0 0 24 24">
                <path
                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                <line x1="12" y1="22.08" x2="12" y2="12" />
            </symbol>
            <symbol id="icon-transistor" viewBox="0 0 24 24">
                <line x1="12" y1="2" x2="12" y2="22" />
                <path d="M4 12h8l-4 6M4 12l4-6" />
            </symbol>
            <symbol id="icon-plus" viewBox="0 0 24 24">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
            </symbol>

            <!-- Misc Icons -->
            <symbol id="icon-chart" viewBox="0 0 24 24">
                <line x1="18" y1="20" x2="18" y2="10" />
                <line x1="12" y1="20" x2="12" y2="4" />
                <line x1="6" y1="20" x2="6" y2="14" />
            </symbol>
            <symbol id="icon-help" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" />
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                <line x1="12" y1="17" x2="12.01" y2="17" />
            </symbol>
            <symbol id="icon-close" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
            </symbol>
            <symbol id="icon-download" viewBox="0 0 24 24">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
            </symbol>
        </defs>
    </svg>

    <div class="app-container">
        <!-- ======== Header ======== -->
        <header class="header">
            <div class="brand">
                <button class="icon-btn" style="width: 32px; height: 32px; min-width: auto; padding: 0;" title="ÌôàÏúºÎ°ú"
                    onclick="goHome()">
                    <svg>
                        <use href="#icon-home" />
                    </svg>
                </button>
                <div class="brand-divider"
                    style="width: 1px; height: 16px; background: var(--border-default); margin: 0 8px;"></div>
                <div class="brand-logo">
                    <svg viewBox="0 0 24 24">
                        <path d="M13 3L4 14h7v7l9-11h-7V3z" />
                    </svg>
                </div>
                <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 8px;">
                    <input type="text" id="project-name-input"
                        style="background: transparent; border: 1px solid transparent; color: white; font-size: 1rem; font-weight: bold; padding: 2px 5px; border-radius: 4px; width: 200px; outline: none; transition: 0.2s;"
                        value="Logic Sim"
                        onchange="if(window.sim && window.sim.updateProjectName) window.sim.updateProjectName(this.value)"
                        onfocus="this.style.borderColor='#3b82f6'; this.style.background='#1e293b'"
                        onblur="this.style.borderColor='transparent'; this.style.background='transparent'">
                    <span id="save-status"
                        style="font-size: 0.75rem; color: #94a3b8; padding-left: 5px; height: 14px; line-height: 14px;"></span>
                </div>
            </div>

            <!-- File -->
            <div class="toolbar-group">
                <button class="icon-btn" onclick="sim.newProject()" title="ÏÉà ÌîÑÎ°úÏ†ùÌä∏ (N)">
                    <svg>
                        <use href="#icon-file" />
                    </svg>
                    <span class="btn-text">ÏÉà ÌååÏùº</span>
                </button>
                <button class="icon-btn" onclick="sim.saveProject()" title="ÌååÏùº Ï†ÄÏû• (S)">
                    <svg>
                        <use href="#icon-save" />
                    </svg>
                    <span class="btn-text">ÏàòÎèô Ï†ÄÏû•</span>
                </button>

                <button class="icon-btn" onclick="sim.exportProject()" title="JSON ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
                    <svg>
                        <use href="#icon-export" />
                    </svg>
                    <span class="btn-text">ÎÇ¥Î≥¥ÎÇ¥Í∏∞</span>
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <!-- Edit -->
            <div class="toolbar-group">
                <button class="icon-btn" onclick="sim.undo()" title="Ïã§Ìñâ Ï∑®ÏÜå (Ctrl+Z)">
                    <svg>
                        <use href="#icon-undo" />
                    </svg>
                    <span class="btn-text">Ï∑®ÏÜå</span>
                </button>
                <button class="icon-btn" onclick="sim.redo()" title="Îã§Ïãú Ïã§Ìñâ (Ctrl+Y)">
                    <svg>
                        <use href="#icon-redo" />
                    </svg>
                    <span class="btn-text">Î≥µÍµ¨</span>
                </button>
                <div class="toolbar-divider"></div>
                <button class="icon-btn" onclick="sim.copySelection()" title="Î≥µÏÇ¨ (Ctrl+C)">
                    <svg>
                        <use href="#icon-copy" />
                    </svg>
                    <span class="btn-text">Î≥µÏÇ¨</span>
                </button>
                <button class="icon-btn" onclick="sim.pasteFromClipboard()" title="Î∂ôÏó¨ÎÑ£Í∏∞ (Ctrl+V)">
                    <svg>
                        <use href="#icon-paste" />
                    </svg>
                    <span class="btn-text">Î∂ôÏó¨ÎÑ£Í∏∞</span>
                </button>
                <button class="icon-btn" onclick="sim.deleteSelected()" title="ÏÇ≠Ï†ú (Del)">
                    <svg>
                        <use href="#icon-trash" />
                    </svg>
                    <span class="btn-text">ÏÇ≠Ï†ú</span>
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <!-- Tools -->
            <div class="toolbar-group">
                <!-- Tool Buttons Removed (Integrated functionality)
                <div class="tool-toggle">
                    <button class="icon-btn active" id="btn-select" onclick="sim.setMode('edit')" title="ÏÑ†ÌÉù ÎèÑÍµ¨ (V)">
                        <svg>
                            <use href="#icon-select" />
                        </svg>
                        <span class="tool-label">ÏÑ†ÌÉù</span>
                    </button>
                    <button class="icon-btn" id="btn-pan" onclick="sim.setMode('pan')" title="ÌôîÎ©¥ Ïù¥Îèô (H)">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2 L12 22 M2 12 L22 12" stroke="currentColor" stroke-width="2" fill="none"
                                stroke-linecap="round" />
                            <path d="M12 2 L8 6 M12 2 L16 6" stroke="currentColor" stroke-width="2" fill="none"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M12 22 L8 18 M12 22 L16 18" stroke="currentColor" stroke-width="2" fill="none"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M2 12 L6 8 M2 12 L6 16" stroke="currentColor" stroke-width="2" fill="none"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M22 12 L18 8 M22 12 L18 16" stroke="currentColor" stroke-width="2" fill="none"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <span class="tool-label">Ïù¥Îèô</span>
                    </button>
                </div>
                -->

                <!-- Grid & Wire Mode -->
                <div class="edit-options">
                    <button class="icon-btn small" id="btn-grid-snap" onclick="sim.toggleGridSnap()"
                        title="Í∑∏Î¶¨Îìú Ïä§ÎÉÖ ON/OFF">
                        <span>#</span>
                    </button>
                    <button class="icon-btn small" id="btn-wire-mode" onclick="sim.toggleWireMode()" title="ÏôÄÏù¥Ïñ¥ Ïó∞Í≤∞ Î™®Îìú">
                        Pin
                    </button>
                </div>
            </div>

            <div class="toolbar-divider"></div>

            <!-- Simulation -->
            <div class="toolbar-group">
                <button class="icon-btn" id="btn-run" onclick="sim.toggleSimulation()" title="ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë/Ï†ïÏßÄ">
                    <svg>
                        <use href="#icon-play" />
                    </svg>
                    <span class="btn-text">Ïã§Ìñâ</span>
                </button>
                <button class="icon-btn" onclick="sim.stepSimulation()" title="Ìïú Îã®Í≥Ñ Ïã§Ìñâ">
                    <svg>
                        <use href="#icon-step" />
                    </svg>
                    <span class="btn-text">Ïä§ÌÖù</span>
                </button>
                <button class="icon-btn" onclick="sim.resetSimulation()" title="ÏãúÎÆ¨Î†àÏù¥ÏÖò Ï¥àÍ∏∞Ìôî">
                    <svg>
                        <use href="#icon-reset" />
                    </svg>
                    <span class="btn-text">Î¶¨ÏÖã</span>
                </button>
            </div>

            <!-- Speed Control -->
            <div class="speed-control">
                <label class="speed-label">‚ö° ÏÜçÎèÑ</label>
                <input type="range" class="speed-slider" id="speed-slider" min="0.1" max="5" step="0.1" value="1"
                    oninput="sim.updateSpeedLabel(parseFloat(this.value))"
                    onchange="sim.setSimulationSpeed(parseFloat(this.value), true)">
                <span class="speed-value" id="speed-value">1.0x</span>
            </div>

            <div class="toolbar-spacer"></div>

            <!-- Zoom -->
            <div class="zoom-control">
                <button class="icon-btn" onclick="sim.zoom(-0.1)">
                    <svg>
                        <use href="#icon-zoom-out" />
                    </svg>
                </button>
                <span class="zoom-value" id="zoom-level">100%</span>
                <button class="icon-btn" onclick="sim.zoom(0.1)">
                    <svg>
                        <use href="#icon-zoom-in" />
                    </svg>
                </button>
                <button class="icon-btn" onclick="sim.resetZoom()" title="ÌôîÎ©¥ ÎßûÏ∂§">
                    <svg>
                        <use href="#icon-zoom-fit" />
                    </svg>
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <!-- Selection Indicator -->
            <span class="selection-indicator" id="selection-count" style="display: none;">ÏÑ†ÌÉù: 0Í∞ú</span>

            <div class="toolbar-divider"></div>

            <!-- Utils -->
            <div class="toolbar-group">
                <button class="icon-btn" onclick="sim.showTruthTable()" title="ÏßÑÎ¶¨Ìëú ÏÉùÏÑ±">
                    <svg>
                        <use href="#icon-chart" />
                    </svg>
                    <span class="btn-text">ÏßÑÎ¶¨Ìëú</span>
                </button>
                <button class="icon-btn" onclick="sim.showHelp()" title="ÎèÑÏõÄÎßê">
                    <svg>
                        <use href="#icon-help" />
                    </svg>
                    <span class="btn-text">ÎèÑÏõÄÎßê</span>
                </button>
            </div>
        </header>

        <!-- ======== Sidebar ======== -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-toggle-btn" onclick="sim.toggleSidebar()" title="ÏÇ¨Ïù¥ÎìúÎ∞î Ïó¥Í∏∞/Îã´Í∏∞">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <path d="M8 2 L4 6 L8 10" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" />
                </svg>
            </button>

            <div class="sidebar-content">
                <!-- Account Status -->
                <div class="account-section">
                    <div class="account-avatar">üë§</div>
                    <div class="account-info">
                        <span class="account-name" id="account-name">Guest</span>
                        <span class="account-plan">Free Plan</span>
                    </div>
                </div>

                <!-- IO -->
                <section class="section" id="sec-io">
                    <div class="section-header" onclick="sim.toggleSection('sec-io')">
                        <span class="section-title">
                            <svg class="section-arrow">
                                <use href="#icon-chevron-down" />
                            </svg>
                            ÏûÖÏ∂úÎ†•
                        </span>
                    </div>
                    <div class="section-content">
                        <div class="comp-grid">
                            <button class="comp-btn io" onclick="sim.addModule('SWITCH')"
                                onmouseenter="sim.showTooltip('SWITCH'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 44 44">
                                        <circle cx="22" cy="22" r="16" fill="none" stroke="#22c55e"
                                            stroke-width="2.5" />
                                        <line x1="22" y1="10" x2="22" y2="22" stroke="#22c55e" stroke-width="2.5"
                                            stroke-linecap="round" />
                                    </svg>
                                </div>
                                <span class="name">Ïä§ÏúÑÏπò</span>
                            </button>
                            <button class="comp-btn io" onclick="sim.addModule('LED')"
                                onmouseenter="sim.showTooltip('LED'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 32 32">
                                        <circle cx="16" cy="16" r="11" fill="#ef4444" stroke="#fca5a5"
                                            stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">LED</span>
                            </button>
                            <button class="comp-btn io" onclick="sim.addModule('CLOCK')"
                                onmouseenter="sim.showTooltip('CLOCK'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 56 40">
                                        <rect x="6" y="8" width="44" height="24" rx="2" fill="none" stroke="#8b5cf6"
                                            stroke-width="2" />
                                        <polyline points="12,24 12,16 20,16 20,24 28,24 28,16 36,16 36,24 44,24 44,16"
                                            fill="none" stroke="#8b5cf6" stroke-width="2" stroke-linejoin="miter" />
                                    </svg>
                                </div>
                                <span class="name">ÌÅ¥Îü≠</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Gates -->
                <section class="section" id="sec-gates">
                    <div class="section-header" onclick="sim.toggleSection('sec-gates')">
                        <span class="section-title">
                            <svg class="section-arrow">
                                <use href="#icon-chevron-down" />
                            </svg>
                            ÎÖºÎ¶¨ Í≤åÏù¥Ìä∏
                        </span>
                        <span class="section-count">7</span>
                    </div>
                    <div class="section-content">
                        <div class="comp-grid">
                            <button class="comp-btn gate-and" onclick="sim.addModule('AND')"
                                onmouseenter="sim.showTooltip('AND'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 48 32">
                                        <path d="M8 4 L24 4 A 12 14 0 0 1 24 28 L8 28 Z" fill="none" stroke="#3b82f6"
                                            stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">AND</span>
                            </button>
                            <button class="comp-btn gate-or" onclick="sim.addModule('OR')"
                                onmouseenter="sim.showTooltip('OR'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 48 32">
                                        <path d="M6 4 Q 14 16 6 28 Q 24 28 38 16 Q 24 4 6 4 Z" fill="none"
                                            stroke="#10b981" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">OR</span>
                            </button>
                            <button class="comp-btn gate-not" onclick="sim.addModule('NOT')"
                                onmouseenter="sim.showTooltip('NOT'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 44 32">
                                        <path d="M6 4 L30 16 L6 28 Z" fill="none" stroke="#ef4444" stroke-width="2" />
                                        <circle cx="35" cy="16" r="4" fill="none" stroke="#ef4444" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">NOT</span>
                            </button>
                            <button class="comp-btn gate-nand" onclick="sim.addModule('NAND')"
                                onmouseenter="sim.showTooltip('NAND'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 48 32">
                                        <path d="M6 4 L20 4 A 12 14 0 0 1 20 28 L6 28 Z" fill="none" stroke="#8b5cf6"
                                            stroke-width="2" />
                                        <circle cx="36" cy="16" r="4" fill="none" stroke="#8b5cf6" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">NAND</span>
                            </button>
                            <button class="comp-btn gate-nor" onclick="sim.addModule('NOR')"
                                onmouseenter="sim.showTooltip('NOR'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 48 32">
                                        <path d="M4 4 Q 12 16 4 28 Q 20 28 32 16 Q 20 4 4 4 Z" fill="none"
                                            stroke="#f59e0b" stroke-width="2" />
                                        <circle cx="38" cy="16" r="4" fill="none" stroke="#f59e0b" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">NOR</span>
                            </button>
                            <button class="comp-btn gate-xor" onclick="sim.addModule('XOR')"
                                onmouseenter="sim.showTooltip('XOR'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 48 32">
                                        <path d="M10 4 Q 18 16 10 28 Q 26 28 40 16 Q 26 4 10 4 Z" fill="none"
                                            stroke="#06b6d4" stroke-width="2" />
                                        <path d="M4 4 Q 12 16 4 28" fill="none" stroke="#06b6d4" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">XOR</span>
                            </button>
                            <button class="comp-btn gate-xnor" onclick="sim.addModule('XNOR')"
                                onmouseenter="sim.showTooltip('XNOR'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 48 32">
                                        <path d="M10 4 Q 18 16 10 28 Q 24 28 34 16 Q 24 4 10 4 Z" fill="none"
                                            stroke="#ec4899" stroke-width="2" />
                                        <path d="M4 4 Q 12 16 4 28" fill="none" stroke="#ec4899" stroke-width="2" />
                                        <circle cx="40" cy="16" r="4" fill="none" stroke="#ec4899" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">XNOR</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Modules -->
                <section class="section" id="section-modules">
                    <div class="section-header" onclick="sim.toggleSection('section-modules')">
                        <span class="section-title">
                            <svg class="section-arrow">
                                <use href="#icon-chevron-down" />
                            </svg>
                            Modules
                        </span>
                    </div>
                    <div class="section-content">
                        <div class="comp-grid">
                            <button class="comp-btn package wide" onclick="sim.addPackage('HALF_ADDER')">
                                <div class="icon"><svg>
                                        <use href="#icon-plus" />
                                    </svg></div>
                                <span class="name">Half Adder</span>
                            </button>
                            <button class="comp-btn package wide" onclick="sim.addPackage('FULL_ADDER')">
                                <div class="icon"><svg>
                                        <use href="#icon-plus" />
                                    </svg></div>
                                <span class="name">Full Adder</span>
                            </button>
                            <button class="comp-btn package wide" onclick="sim.addPackage('SR_LATCH')">
                                <div class="icon"><svg>
                                        <use href="#icon-package" />
                                    </svg></div>
                                <span class="name">SR Latch</span>
                            </button>
                            <button class="comp-btn package wide" onclick="sim.addPackage('D_FLIPFLOP')">
                                <div class="icon"><svg>
                                        <use href="#icon-package" />
                                    </svg></div>
                                <span class="name">D Flip-Flop</span>
                            </button>
                        </div>
                        <div id="user-packages" style="margin-top: 8px;"></div>
                        <button class="comp-btn wide dashed" onclick="sim.startNewModule()" style="margin-top: 8px;">
                            <div class="icon"><svg>
                                    <use href="#icon-plus" />
                                </svg></div>
                            <span class="name">ÏÉà Î™®Îìà ÎßåÎì§Í∏∞</span>
                        </button>
                    </div>
                </section>

                <!-- Transistors -->
                <section class="section" id="section-transistors">
                    <div class="section-header" onclick="sim.toggleSection('section-transistors')">
                        <span class="section-title">
                            <svg class="section-arrow">
                                <use href="#icon-chevron-down" />
                            </svg>
                            Transistors
                        </span>
                        <span class="section-count">4</span>
                    </div>
                    <div class="section-content">
                        <div class="comp-grid">
                            <button class="comp-btn trans-npn" onclick="sim.addModule('TRANSISTOR')"
                                onmouseenter="sim.showTooltip('TRANSISTOR'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 48 48">
                                        <!-- NPN Transistor Symbol -->
                                        <line x1="16" y1="12" x2="16" y2="36" stroke="#06b6d4" stroke-width="2.5" />
                                        <line x1="16" y1="18" x2="32" y2="10" stroke="#06b6d4" stroke-width="2.5" />
                                        <line x1="16" y1="30" x2="32" y2="38" stroke="#06b6d4" stroke-width="2.5" />
                                        <polygon points="28,34 32,38 26,38" fill="#06b6d4" />
                                        <line x1="4" y1="24" x2="16" y2="24" stroke="#06b6d4" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">NPN</span>
                            </button>
                            <button class="comp-btn trans-pmos" onclick="sim.addModule('PMOS')"
                                onmouseenter="sim.showTooltip('PMOS'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 48 48">
                                        <!-- PMOS Transistor Symbol -->
                                        <line x1="16" y1="12" x2="16" y2="36" stroke="#8b5cf6" stroke-width="2.5" />
                                        <line x1="16" y1="18" x2="32" y2="10" stroke="#8b5cf6" stroke-width="2.5" />
                                        <line x1="16" y1="30" x2="32" y2="38" stroke="#8b5cf6" stroke-width="2.5" />
                                        <polygon points="20,22 16,24 20,26" fill="#8b5cf6" />
                                        <line x1="4" y1="24" x2="16" y2="24" stroke="#8b5cf6" stroke-width="2" />
                                        <circle cx="12" cy="24" r="2" fill="none" stroke="#8b5cf6" stroke-width="1.5" />
                                    </svg>
                                </div>
                                <span class="name">PMOS</span>
                            </button>
                            <button class="comp-btn power-vcc" onclick="sim.addModule('VCC')"
                                onmouseenter="sim.showTooltip('VCC'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 44 40">
                                        <!-- VCC: ÌôîÏÇ¥Ìëú Ïò§Î•∏Ï™Ω, ÏÑ† ÏôºÏ™Ω -->
                                        <line x1="0" y1="20" x2="24" y2="20" stroke="#ef4444" stroke-width="3" />
                                        <polygon points="40,20 24,10 24,30" fill="#ef4444" stroke="#ef4444"
                                            stroke-width="2" stroke-linejoin="round" />
                                    </svg>
                                </div>
                                <span class="name">VCC</span>
                            </button>
                            <button class="comp-btn power-gnd" onclick="sim.addModule('GND')"
                                onmouseenter="sim.showTooltip('GND'); sim.positionTooltip(event)"
                                onmouseleave="sim.hideTooltip()">
                                <div class="icon">
                                    <svg viewBox="0 0 44 40">
                                        <!-- GND: ÏÑ† ÏôºÏ™Ω, Ï†ëÏßÄ Ïã¨Î≥º Ïò§Î•∏Ï™Ω -->
                                        <line x1="0" y1="20" x2="24" y2="20" stroke="#94a3b8" stroke-width="3" />
                                        <line x1="24" y1="6" x2="24" y2="34" stroke="#94a3b8" stroke-width="3" />
                                        <line x1="32" y1="10" x2="32" y2="30" stroke="#94a3b8" stroke-width="2.5" />
                                        <line x1="40" y1="14" x2="40" y2="26" stroke="#94a3b8" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="name">GND</span>
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </aside>

        <!-- ======== Workspace with Tabs ======== -->
        <main class="workspace-wrapper">
            <!-- Tab Bar -->
            <div class="workspace-tabs" id="workspace-tabs">
                <div class="tab active" data-tab="main" onclick="sim.switchTab('main')">
                    <span class="tab-icon"><svg>
                            <use href="#icon-wire" />
                        </svg></span>
                    <span class="tab-title">Î©îÏù∏ ÌöåÎ°ú</span>
                </div>
                <div class="tab" data-tab="module" id="module-tab" style="display: none;"
                    onclick="sim.switchTab('module')">
                    <span class="tab-icon"><svg>
                            <use href="#icon-package" />
                        </svg></span>
                    <span class="tab-title" id="module-tab-title">Î™®Îìà Ìé∏Ïßë</span>
                    <button class="tab-close" onclick="event.stopPropagation(); sim.closeModuleTab()">√ó</button>
                </div>
            </div>

            <!-- Main Circuit Workspace -->
            <div id="workspace" class="workspace-content active">
                <svg id="wire-layer"></svg>
            </div>

            <!-- Module Editor Workspace (Hidden by default) -->
            <div id="module-workspace" class="workspace-content module-editor" style="display: none;">
                <div class="module-editor-header">
                    <div class="module-info">
                        <input type="text" class="module-name-input" id="editing-module-name" value="ÏÉà Î™®Îìà"
                            placeholder="Î™®Îìà Ïù¥Î¶Ñ ÏûÖÎ†•">
                        <span class="module-desc">ÏÜåÏûêÎ•º Î∞∞ÏπòÌïòÍ≥† ÏûÖÏ∂úÎ†• Ìè¨Ìä∏Î•º Ïó∞Í≤∞ÌïòÏÑ∏Ïöî</span>
                    </div>
                    <div class="module-actions">
                        <button class="btn-module-action save" id="btn-save-as-new" onclick="sim.saveAsNewModule()">
                            Î™®ÎìàÎ°ú Ï†ÄÏû•
                        </button>
                        <button class="btn-module-action" id="btn-save-changes" onclick="sim.saveModuleChanges()"
                            style="display: none;">
                            Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Ï†ÄÏû•
                        </button>
                        <button class="btn-module-action secondary" onclick="sim.closeModuleTab()">
                            Îã´Í∏∞
                        </button>
                    </div>
                </div>

                <div class="module-editor-body">
                    <!-- Component Palette for Module -->
                    <div class="module-palette">
                        <div class="palette-section">
                            <h5>ÏûÖÏ∂úÎ†•</h5>
                            <div class="palette-grid">
                                <button class="palette-btn input" onclick="sim.addModuleComponent('PORT_IN')"
                                    title="ÏûÖÎ†• Ìè¨Ìä∏">
                                    <span class="icon">‚Üí</span>
                                    <span class="label">ÏûÖÎ†•</span>
                                </button>
                                <button class="palette-btn output" onclick="sim.addModuleComponent('PORT_OUT')"
                                    title="Ï∂úÎ†• Ìè¨Ìä∏">
                                    <span class="icon">‚Üí</span>
                                    <span class="label">Ï∂úÎ†•</span>
                                </button>
                            </div>
                        </div>
                        <div class="palette-section">
                            <h5>‚ö° Í≤åÏù¥Ìä∏</h5>
                            <div class="palette-grid">
                                <button class="palette-btn" onclick="sim.addModuleComponent('AND')"
                                    title="AND Í≤åÏù¥Ìä∏">AND</button>
                                <button class="palette-btn" onclick="sim.addModuleComponent('OR')"
                                    title="OR Í≤åÏù¥Ìä∏">OR</button>
                                <button class="palette-btn" onclick="sim.addModuleComponent('NOT')"
                                    title="NOT Í≤åÏù¥Ìä∏">NOT</button>
                                <button class="palette-btn" onclick="sim.addModuleComponent('NAND')"
                                    title="NAND Í≤åÏù¥Ìä∏">NAND</button>
                                <button class="palette-btn" onclick="sim.addModuleComponent('NOR')"
                                    title="NOR Í≤åÏù¥Ìä∏">NOR</button>
                                <button class="palette-btn" onclick="sim.addModuleComponent('XOR')"
                                    title="XOR Í≤åÏù¥Ìä∏">XOR</button>
                                <button class="palette-btn" onclick="sim.addModuleComponent('XNOR')"
                                    title="XNOR Í≤åÏù¥Ìä∏">XNOR</button>
                            </div>
                        </div>
                        <div class="palette-section">
                            <h5>üìä ÌòÑÏû¨ Î™®Îìà Ï†ïÎ≥¥</h5>
                            <div class="module-stats">
                                <div class="stat-row">
                                    <span>ÏûÖÎ†•:</span>
                                    <span id="module-input-count">0</span>
                                </div>
                                <div class="stat-row">
                                    <span>Ï∂úÎ†•:</span>
                                    <span id="module-output-count">0</span>
                                </div>
                                <div class="stat-row">
                                    <span>Í≤åÏù¥Ìä∏:</span>
                                    <span id="module-gate-count">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="palette-section">
                            <h5>Ìå®ÌÇ§ÏßÄ ÌÅ¨Í∏∞</h5>
                            <div class="size-inputs">
                                <div class="size-row">
                                    <label>ÎÑàÎπÑ:</label>
                                    <input type="number" id="module-width" value="90" min="60" max="200" step="10">
                                </div>
                                <div class="size-row">
                                    <label>ÎÜíÏù¥:</label>
                                    <input type="number" id="module-height" value="60" min="40" max="200" step="10">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Module Canvas -->
                    <div class="module-canvas" id="module-canvas">
                        <svg id="module-wire-layer"></svg>
                    </div>
                </div>

                <!-- Module I/O Summary Panel -->
                <div class="module-io-panel">
                    <div class="io-section">
                        <h4>üì• ÏûÖÎ†• Ìè¨Ìä∏</h4>
                        <div id="module-inputs" class="io-list"></div>
                    </div>
                    <div class="io-section">
                        <h4>üì§ Ï∂úÎ†• Ìè¨Ìä∏</h4>
                        <div id="module-outputs" class="io-list"></div>
                    </div>
                    <div class="io-section wide">
                        <h4>ÎèÑÏõÄÎßê</h4>
                        <p class="io-help">ÏûÖÎ†•/Ï∂úÎ†• Ìè¨Ìä∏Î•º Î∞∞ÏπòÌïòÍ≥† Í≤åÏù¥Ìä∏Î°ú Ïó∞Í≤∞ÌïòÏÑ∏Ïöî. ÌïÄÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏôÄÏù¥Ïñ¥Î•º Ïó∞Í≤∞Ìï©ÎãàÎã§.</p>
                    </div>
                </div>
            </div>

            <div class="minimap" id="minimap">
                <div class="minimap-viewport" id="minimap-viewport"></div>
            </div>
        </main>

        <!-- Selection Box (body ÏßÅÏ†ë ÏûêÏãùÏúºÎ°ú Ïù¥Îèô - transform containing block Î¨∏Ï†ú Ìï¥Í≤∞) -->
        <div id="selection-box"></div>

        <!-- Component Info Panel (Ï¢åÏ∏° ÏÉÅÎã® - ÎèÖÎ¶ΩÏ†Å ÏúÑÏπò) -->
        <div id="component-info-panel" class="component-info-panel hidden">
            <div class="info-header">
                <span class="info-type-icon"><svg width="16" height="16">
                        <use href="#icon-wire" />
                    </svg></span>
                <span class="info-type-name">Component</span>
            </div>
            <!-- Ïï†ÎãàÎ©îÏù¥ÏÖò ÏòÅÏó≠ -->
            <div class="info-animation" id="info-animation">
                <!-- SVG Ïï†ÎãàÎ©îÏù¥ÏÖòÏù¥ Ïó¨Í∏∞Ïóê ÏÇΩÏûÖÎê® -->
            </div>
            <div class="info-body">
                <p class="info-description">ÏÜåÏûêÎ•º ÏÑ†ÌÉùÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÏÑ§Î™ÖÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>
                <!-- ÏÇ¨Ïö©Î≤ï ÏòÅÏó≠ -->
                <div class="info-usage" id="info-usage-section">
                    <div class="info-usage-title">Tip</div>
                    <p class="info-usage-content" id="info-usage"></p>
                </div>
                <div class="info-details">
                    <div class="info-row">
                        <span class="info-label">ÏûÖÎ†•:</span>
                        <span class="info-value" id="info-inputs">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ï∂úÎ†•:</span>
                        <span class="info-value" id="info-outputs">-</span>
                    </div>
                </div>
                <div class="info-truth-table" id="info-truth-table" style="display: none;">
                    <span class="info-label">ÏßÑÎ¶¨Ìëú:</span>
                    <table class="truth-table"></table>
                </div>
            </div>
        </div>

        <!-- ======== Status Bar ======== -->
        <footer class="statusbar">
            <div class="status-item">
                <span class="status-dot"></span>
                <span>Ready</span>
            </div>
            <div class="status-item" id="status-components">Components: 0</div>
            <div class="status-item" id="status-wires">Wires: 0</div>
            <div class="statusbar-spacer"></div>
            <div class="status-item" id="status-position">X: 0, Y: 0</div>
        </footer>
    </div>

    <!-- ======== Context Menu ======== -->
    <div id="context-menu">
        <div class="ctx-item" onclick="sim.copySelection()">
            <svg>
                <use href="#icon-copy" />
            </svg>
            Î≥µÏÇ¨
            <span class="shortcut">Ctrl+C</span>
        </div>
        <div class="ctx-item" onclick="sim.pasteFromClipboard()">
            <svg>
                <use href="#icon-paste" />
            </svg>
            Î∂ôÏó¨ÎÑ£Í∏∞
            <span class="shortcut">Ctrl+V</span>
        </div>
        <div class="ctx-item" onclick="sim.duplicateSelection()">
            <svg>
                <use href="#icon-duplicate" />
            </svg>
            Î≥µÏ†ú
            <span class="shortcut">Ctrl+D</span>
        </div>
        <div class="ctx-sep"></div>
        <!-- LED Color Options -->
        <div class="ctx-item ctx-led-only" onclick="sim.setLEDColor('red')">
            <span style="color:#ef4444;">‚óè</span> Îπ®Í∞ï LED
        </div>
        <div class="ctx-item ctx-led-only" onclick="sim.setLEDColor('green')">
            <span style="color:#22c55e;">‚óè</span> Ï¥àÎ°ù LED
        </div>
        <div class="ctx-item ctx-led-only" onclick="sim.setLEDColor('blue')">
            <span style="color:#3b82f6;">‚óè</span> ÌååÎûë LED
        </div>
        <div class="ctx-item ctx-led-only" onclick="sim.setLEDColor('yellow')">
            <span style="color:#eab308;">‚óè</span> ÎÖ∏Îûë LED
        </div>
        <div class="ctx-item ctx-led-only" onclick="sim.setLEDColor('white')">
            <span style="color:#f8fafc;">‚óè</span> Ìù∞ÏÉâ LED
        </div>
        <div class="ctx-sep ctx-led-only"></div>
        <!-- Alignment Tools -->
        <div class="ctx-item" onclick="sim.alignSelectedHorizontal()">
            <svg viewBox="0 0 24 24">
                <line x1="12" y1="4" x2="12" y2="20" stroke="currentColor" stroke-width="2" />
                <line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2" />
            </svg>
            ÏàòÌèâ Ï†ïÎ†¨
        </div>
        <div class="ctx-item" onclick="sim.alignSelectedVertical()">
            <svg viewBox="0 0 24 24">
                <line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2" />
                <line x1="12" y1="4" x2="12" y2="20" stroke="currentColor" stroke-width="2" />
            </svg>
            ÏàòÏßÅ Ï†ïÎ†¨
        </div>
        <div class="ctx-item" onclick="sim.distributeHorizontal()">
            ‚¨å ÏàòÌèâ Í∑†Îì±
        </div>
        <div class="ctx-item" onclick="sim.distributeVertical()">
            ‚¨ç ÏàòÏßÅ Í∑†Îì±
        </div>
        <div class="ctx-sep"></div>
        <!-- Rotate & Flip -->
        <div class="ctx-item" onclick="sim.rotateSelected()">
            <svg viewBox="0 0 24 24">
                <path d="M23 4v6h-6M1 20v-6h6" stroke="currentColor" stroke-width="2" fill="none" />
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" stroke="currentColor"
                    stroke-width="2" fill="none" />
            </svg>
            ÌöåÏ†Ñ
            <span class="shortcut">R</span>
        </div>
        <div class="ctx-item" onclick="sim.flipHorizontal()">
            ‚ÜîÔ∏è Ï¢åÏö∞ Î∞òÏ†Ñ
        </div>
        <div class="ctx-item" onclick="sim.flipVertical()">
            ‚ÜïÔ∏è ÏÉÅÌïò Î∞òÏ†Ñ
        </div>
        <div class="ctx-sep"></div>
        <div class="ctx-item danger" onclick="sim.deleteSelected()">
            <svg>
                <use href="#icon-trash" />
            </svg>
            ÏÇ≠Ï†ú
            <span class="shortcut">Del</span>
        </div>
    </div>

    <!-- ======== Interactive Tooltip Panel ======== -->
    <div id="tooltip" class="tooltip-panel">
        <div class="tooltip-header">
            <div class="tooltip-icon" id="tooltip-icon"></div>
            <div class="tooltip-title-area">
                <div id="tooltip-title" class="tooltip-title"></div>
                <div id="tooltip-type" class="tooltip-type"></div>
            </div>
        </div>
        <div class="tooltip-animation" id="tooltip-animation">
            <!-- SVG animation will be inserted here -->
        </div>
        <div class="tooltip-content">
            <div id="tooltip-desc" class="tooltip-desc"></div>
            <div class="tooltip-usage">
                <div class="tooltip-usage-title">Tip</div>
                <div id="tooltip-usage" class="tooltip-usage-content"></div>
            </div>
            <div class="tooltip-shortcuts" id="tooltip-shortcuts"></div>
        </div>
    </div>

    <!-- ======== Help Modal ======== -->
    <div class="modal-overlay" id="help-modal">
        <div class="modal" style="max-width: 560px;">
            <div class="modal-header">
                <h2 class="modal-title">Keyboard Shortcuts</h2>
                <button class="modal-close" onclick="document.getElementById('help-modal').classList.remove('show')">
                    <svg width="16" height="16">
                        <use href="#icon-close" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-item"><span class="shortcut-key">V</span><span class="shortcut-desc">Select
                            Tool</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">H</span><span class="shortcut-desc">Pan
                            Tool</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">W</span><span class="shortcut-desc">Wire
                            Tool</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Space</span><span class="shortcut-desc">Temp
                            Pan</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Del</span><span
                            class="shortcut-desc">Delete</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Esc</span><span
                            class="shortcut-desc">Deselect</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Ctrl+A</span><span
                            class="shortcut-desc">Select All</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Ctrl+C</span><span
                            class="shortcut-desc">Copy</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Ctrl+V</span><span
                            class="shortcut-desc">Paste</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Ctrl+D</span><span
                            class="shortcut-desc">Duplicate</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Ctrl+S</span><span
                            class="shortcut-desc">Save</span></div>
                    <div class="shortcut-item"><span class="shortcut-key">Ctrl+Z</span><span
                            class="shortcut-desc">Undo</span></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary"
                    onclick="document.getElementById('help-modal').classList.remove('show')">Close</button>
            </div>
        </div>
    </div>

    <!-- ======== Truth Table Modal ======== -->
    <div class="modal-overlay" id="truth-table-modal">
        <div class="modal" style="max-width: 640px;">
            <div class="modal-header">
                <h2 class="modal-title">Truth Table</h2>
                <button class="modal-close"
                    onclick="document.getElementById('truth-table-modal').classList.remove('show')">
                    <svg width="16" height="16">
                        <use href="#icon-close" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="truth-table-content">
                <p style="color: var(--text-muted); text-align: center; padding: 32px;">
                    Add switches and LEDs to generate a truth table.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="sim.exportTruthTable()">
                    <svg width="14" height="14">
                        <use href="#icon-download" />
                    </svg>
                    Export CSV
                </button>
                <button class="btn btn-primary" onclick="sim.generateTruthTable()">Generate</button>
            </div>
        </div>
    </div>

    <!-- ======== New Project Modal ======== -->
    <div class="modal-overlay" id="new-project-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">New Project</h2>
                <button class="modal-close"
                    onclick="document.getElementById('new-project-modal').classList.remove('show')">
                    <svg width="16" height="16">
                        <use href="#icon-close" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶Ñ (Project Name)</label>
                    <input type="text" class="form-input" id="new-proj-name" placeholder="ÎÇòÏùò ÌöåÎ°ú">
                </div>
                <div class="form-row" style="display: flex; gap: 16px; margin-top: 16px;">
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">ÎÑàÎπÑ (Width)</label>
                        <input type="number" class="form-input" id="new-proj-width" value="3000" step="100">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">ÎÜíÏù¥ (Height)</label>
                        <input type="number" class="form-input" id="new-proj-height" value="2000" step="100">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost"
                    onclick="document.getElementById('new-project-modal').classList.remove('show')">Cancel</button>
                <button class="btn btn-primary" onclick="sim.confirmNewProject()">Create</button>
            </div>
        </div>
    </div>

    <!-- ======== Feedback Floating Button & Modal ======== -->
    <button class="feedback-fab" onclick="openFeedbackModal()" title="ÌîºÎìúÎ∞± Î≥¥ÎÇ¥Í∏∞">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </button>

    <div class="modal-overlay" id="feedback-modal">
        <div class="modal feedback-modal">
            <div class="modal-header">
                <h2 class="modal-title">üí¨ ÌîºÎìúÎ∞± Î≥¥ÎÇ¥Í∏∞</h2>
                <button class="modal-close" onclick="closeFeedbackModal()">
                    <svg width="16" height="16">
                        <use href="#icon-close" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 14px;">
                    LoCADÎ•º ÏÇ¨Ïö©Ìï¥Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§!<br>
                    Î≤ÑÍ∑∏ Î¶¨Ìè¨Ìä∏, Í∏∞Îä• Ï†úÏïà, ÎòêÎäî ÏùòÍ≤¨ÏùÑ ÏûêÏú†Î°≠Í≤å ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî.
                </p>
                <div class="form-group">
                    <label class="form-label">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                    <select id="feedback-category" class="form-input" style="width: 100%;">
                        <option value="bug">üêõ Î≤ÑÍ∑∏ Î¶¨Ìè¨Ìä∏</option>
                        <option value="feature">Í∏∞Îä• Ï†úÏïà</option>
                        <option value="ux">üé® UI/UX Í∞úÏÑ†</option>
                        <option value="other">üìù Í∏∞ÌÉÄ ÏùòÍ≤¨</option>
                    </select>
                </div>
                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label">ÎÇ¥Ïö©</label>
                    <textarea id="feedback-content" class="form-input"
                        style="width: 100%; min-height: 120px; resize: vertical;"
                        placeholder="Ïó¨Í∏∞Ïóê ÌîºÎìúÎ∞±ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî..."></textarea>
                </div>
                <div class="form-group" style="margin-top: 12px;">
                    <label class="form-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="feedback-include-circuit" checked>
                        ÌòÑÏû¨ ÌöåÎ°ú ÏÉÅÌÉú Ï≤®Î∂Ä (ÎîîÎ≤ÑÍπÖÏóê ÎèÑÏõÄÎê©ÎãàÎã§)
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeFeedbackModal()">Ï∑®ÏÜå</button>
                <button class="btn btn-primary" onclick="submitFeedback()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                    Î≥¥ÎÇ¥Í∏∞
                </button>
            </div>
        </div>
    </div>

    <style>
        /* Feedback Floating Action Button */
        .feedback-fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .feedback-fab:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.6);
        }

        .feedback-fab:active {
            transform: scale(0.95);
        }

        /* Feedback Modal Styles */
        .feedback-modal {
            max-width: 480px;
        }

        .feedback-modal .form-input {
            background: var(--bg-tertiary, #1e293b);
            border: 1px solid var(--border-default, #334155);
            color: var(--text-primary, #f8fafc);
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
        }

        .feedback-modal .form-input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .feedback-modal textarea {
            font-family: inherit;
            line-height: 1.5;
        }

        .feedback-modal .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary, #94a3b8);
            margin-bottom: 8px;
            display: block;
        }
    </style>

    <script>
        function openFeedbackModal() {
            document.getElementById('feedback-modal').classList.add('show');
        }
        function closeFeedbackModal() {
            document.getElementById('feedback-modal').classList.remove('show');
        }
        async function submitFeedback() {
            const category = document.getElementById('feedback-category').value;
            const content = document.getElementById('feedback-content').value.trim();
            const includeCircuit = document.getElementById('feedback-include-circuit').checked;

            if (!content) {
                sim.showToast('ÌîºÎìúÎ∞± ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            // ÌîºÎìúÎ∞± Îç∞Ïù¥ÌÑ∞ Íµ¨ÏÑ±
            const feedbackData = {
                category: category,
                content: content,
                circuit_data: includeCircuit && window.sim ? sim.serializeCircuit?.() : null,
                user_agent: navigator.userAgent,
                url: window.location.href,
                created_at: new Date().toISOString()
            };

            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï∂îÍ∞Ä (Î°úÍ∑∏Ïù∏Îêú Í≤ΩÏö∞)
            if (window.getCurrentUser) {
                const user = await window.getCurrentUser();
                if (user) {
                    feedbackData.user_id = user.id;
                    feedbackData.user_email = user.email;
                }
            }

            // SupabaseÏóê Ï†ÄÏû•
            if (window.sb) {
                try {
                    const { error } = await window.sb.from('feedback').insert([feedbackData]);
                    if (error) throw error;

                    sim.showToast('ÌîºÎìúÎ∞±Ïù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§. Í∞êÏÇ¨Ìï©ÎãàÎã§!', 'success');
                    document.getElementById('feedback-content').value = '';
                    closeFeedbackModal();
                } catch (err) {
                    console.error('Feedback submission error:', err);
                    sim.showToast('ÌîºÎìúÎ∞± Ï†ÑÏÜ° Ïã§Ìå®: ' + err.message, 'error');
                }
            } else {
                // Supabase ÎØ∏Ïó∞Í≤∞ Ïãú Î°úÏª¨ Ï†ÄÏû• ÎòêÎäî ÏΩòÏÜî Ï∂úÎ†•
                console.log('Feedback (local):', feedbackData);
                sim.showToast('ÌîºÎìúÎ∞±Ïù¥ Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§ (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú)', 'info');
                closeFeedbackModal();
            }
        }
    </script>

    <!-- Error Handler -->
    <script>
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            var fileName = url ? url.substring(url.lastIndexOf('/') + 1) : 'Unknown Script';
            var message = "Ïò§Î•ò Î∞úÏÉù [" + fileName + ":" + lineNo + "] " + msg;

            console.error(message, error);

            if (window.sim && typeof window.sim.showToast === 'function') {
                window.sim.showToast(message, 'error');
            } else {
                var errDiv = document.createElement('div');
                errDiv.style.cssText = 'position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(239, 68, 68, 0.95); color:white; padding:12px 24px; border-radius:8px; z-index:10000; font-family:sans-serif; box-shadow:0 8px 20px rgba(0,0,0,0.4); font-weight:500; font-size:14px; backdrop-filter:blur(4px); border:1px solid rgba(255,255,255,0.2);';
                errDiv.innerHTML = message;
                document.body.appendChild(errDiv);
                setTimeout(function () {
                    errDiv.style.opacity = '0';
                    errDiv.style.transition = 'opacity 0.5s';
                    setTimeout(function () { errDiv.remove(); }, 500);
                }, 5000);
            }
            return false;
        };

        window.onunhandledrejection = function (event) {
            var msg = event.reason ? event.reason.message : 'Unknown Async Error';
            var message = "ÎπÑÎèôÍ∏∞ Ïò§Î•ò: " + msg;
            if (window.sim && window.sim.showToast) {
                window.sim.showToast(message, 'error');
            } else {
                console.error("Unhandled Rejection:", event.reason);
            }
        };
    </script>

    <script src="js/modules/Constants.js"></script>
    <script src="js/modules/CircuitSimulator.js"></script>
    <script src="js/modules/PerformanceOptimizer.js"></script>
    <script src="js/modules/InputHandler.js"></script>
    <script src="js/modules/ProjectIO.js?v=10"></script>
    <script src="js/modules/ComponentManager.js"></script>
    <script src="js/modules/WireManager.js"></script>
    <script src="js/modules/SelectionManager.js"></script>
    <script src="js/modules/LogicEngine.js"></script>
    <script src="js/modules/PackageManager.js"></script>
    <script src="js/modules/TabManager.js"></script>
    <script src="js/modules/UIManager.js"></script>
    <script src="js/modules/HistoryManager.js"></script>
    <script src="js/modules/Oscilloscope.js"></script>
    <script src="js/modules/TutorialSystem.js"></script>
    <script src="js/modules/TouchHandler.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/modules/SupabaseClient.js"></script>
    <script src="js/modules/Main.js"></script>
    <script>
        async function goHome() {
            if (window.getCurrentUser) {
                const user = await window.getCurrentUser();
                if (user) {
                    location.href = 'dashboard.html';
                    return;
                }
            }
            location.href = 'index.html';
        }
    </script>
</body>

</html>